parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"eojW":[function(require,module,exports) {
"use strict";var o;Object.defineProperty(exports,"__esModule",{value:!0}),exports.Commands=void 0,function(o){o.RELOAD_WINDOW="workbench.action.reloadWindow",o.OPEN_COC_CONFIG="CocConfig",o.RESTART_COC="CocRestart",o.OPEN_PREVIEW="coc#util#preview_info",o.HAS_PREVIEW="coc#list#has_preview",o.OPEN_LOGS="CocCommand workspace.showOutput",o.MOVE_TO="coc#cursor#move_to"}(o=exports.Commands||(exports.Commands={}));
},{}],"p29A":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function c(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(a,c)}s((n=n.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("coc.nvim");class o{constructor(e){this.currentDecorations=[],this.decorationNameSpace=t.workspace.createNameSpace("worksheetDecorations"),this.floatFactory=e}setDecorations(o){return e(this,void 0,void 0,function*(){const e=t.workspace.getDocument(o.uri),{buffer:n}=e;n.clearNamespace(this.decorationNameSpace),this.currentDecorations=[],o.options.forEach(e=>{var t,o,r,i;this.currentDecorations.push(e),n.setVirtualText(this.decorationNameSpace,e.range.end.line,[[null!==(i=null===(r=null===(o=null===(t=e.renderOptions)||void 0===t?void 0:t.after)||void 0===o?void 0:o.contentText)||void 0===r?void 0:r.replace("//","‣"))&&void 0!==i?i:"","Comment"]])})})}showHover(){return e(this,void 0,void 0,function*(){const{position:e}=yield t.workspace.getCurrentState(),o=this.currentDecorations.find(t=>t.range.end.line===e.line);o&&"string"!=typeof o.hoverMessage&&o.hoverMessage&&(yield this.floatFactory.create([{content:o.hoverMessage.value,filetype:o.hoverMessage.kind}],!0,0))})}clearDecorations(e){const o=t.workspace.getDocument(e),{buffer:n}=o;n.clearNamespace(this.decorationNameSpace),this.currentDecorations=[]}}exports.default=o;
},{}],"BTOZ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.makeVimDoctor=void 0;const e=require("coc.nvim"),t=require("./commands"),r=(e,t)=>{let r;r=0===t?22-e.length:e.length<=2?15+e.length:18-e.length;const s=Math.round(r/2),o=s>0?" ".repeat(s):" ",n=s>0?" ".repeat(r-s):" ";return`${o}${e.toString().replace("\n"," ")}${n}`};function s(s){if(s)if(s.targets){const o=[s.title,"-------------",...s.headerText.split("\n"),"",Object.keys(s.targets[0]).map((e,t)=>r(e,t)).join(" | "),"-".repeat(150),...s.targets.map(e=>Object.values(e).map((e,t)=>r(e.trim(),t)).join(" | ")),""];e.workspace.nvim.call(t.Commands.OPEN_PREVIEW,[o,"txt","setl nonumber","setl nowrap"],!0)}else{const r=[s.title,"-------------",s.headerText,"",s.messages[0].title,"",...s.messages[0].recommendations.map(e=>` - ${e}`),""];e.workspace.nvim.call(t.Commands.OPEN_PREVIEW,[r,"txt","setl nonumber","setl nowrap"],!0)}else e.workspace.showMessage("Unable to run Doctor","error")}exports.makeVimDoctor=s;
},{"./commands":"eojW"}],"z7J4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DecorationsRangesDidChange=void 0;const e=require("vscode-languageserver-protocol");var o;!function(o){o.type=new e.NotificationType("metals/publishDecorations")}(o=exports.DecorationsRangesDidChange||(exports.DecorationsRangesDidChange={}));
},{}],"Iw8s":[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(r,c){function u(t){try{s(o.next(t))}catch(e){c(e)}}function i(t){try{s(o.throw(t))}catch(e){c(e)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(u,i)}s((o=o.apply(t,e||[])).next())})};function e(e,n){const o=(r,c)=>t(this,void 0,void 0,function*(){if(c<e.length){const t=yield n(e[c],c,e);return o(r.concat(t),c+1)}return r});return o([],0)}function n(t,e){const n=t.length,o=new Map;for(let r=0;r<n;r++){const n=t[r],c=e(n);let u=o.get(c);void 0===u&&(u=[],o.set(c,u)),u.push(n)}return o}Object.defineProperty(exports,"__esModule",{value:!0}),exports.groupBy=exports.sequence=void 0,exports.sequence=e,exports.groupBy=n;
},{}],"Vq4m":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,i,t,o){return new(t||(t=Promise))(function(n,d){function r(e){try{h(o.next(e))}catch(i){d(i)}}function s(e){try{h(o.throw(e))}catch(i){d(i)}}function h(e){var i;e.done?n(e.value):(i=e.value,i instanceof t?i:new t(function(e){e(i)})).then(r,s)}h((o=o.apply(e,i||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TreeModel=exports.Node=void 0;const i=require("vscode-jsonrpc"),t=require("./utils");class o{constructor(e,i,t,o,n){this.viewNode=e,this.level=i,this.provider=t,this.emitter=o,this.autoExpand=n,this.lastTouch=Date.now(),this.defunct=!1,this.expanded=!1}expandable(){return void 0!==this.viewNode.collapseState}isExpanded(){return this.expanded}expand(){return e(this,void 0,void 0,function*(){if(this.defunct)return!1;return function i(t,o,n){return e(this,void 0,void 0,function*(){n.viewNode.nodeUri&&n.provider.sendTreeNodeVisibilityNotification(n.viewNode.nodeUri,!1),n.expanded=!0;const e=yield n.getChildren();if(1===e.length&&e[0].expandable()&&n.autoExpand)return i(t,o,e[0]);{const e=yield t.collectVisibleNodes();return o===t.lastTouch&&!t.defunct&&(n.emitter.fire({root:t.makeView(),oldNodes:[t.makeView()],newNodes:e,focusEvent:!1}),!0)}})}(this,yield this.touch(),this)})}collapse(){return e(this,void 0,void 0,function*(){if(this.defunct)return!1;this.viewNode.nodeUri&&this.provider.sendTreeNodeVisibilityNotification(this.viewNode.nodeUri,!0);const e=yield this.touch(),i=yield this.collectVisibleNodes();return this.expanded=!1,e===this.lastTouch&&!this.defunct&&(this.emitter.fire({root:this.makeView(),oldNodes:i,newNodes:[this.makeView()],focusEvent:!1}),!0)})}refreshSubtree(i){return e(this,void 0,void 0,function*(){function o(e,i){return e.expanded===i.expanded&&e.level===i.level&&e.expandable===i.expandable&&e.underlying.nodeUri===i.underlying.nodeUri&&e.underlying.viewId===i.underlying.viewId&&e.underlying.label===i.underlying.label}const n=yield this.collectVisibleNodes();if(this.isExpanded()){const e=yield this.getChildren();yield Promise.resolve(e.map(e=>e.markAsDefunct()))}const d=yield function i(t,o,n){return e(this,void 0,void 0,function*(){return n.isExpanded()?(t.push(o),(yield n.getChildren()).reduce((t,n)=>e(this,void 0,void 0,function*(){return t.then(e=>i(e,n.viewNode.nodeUri?o.concat(n.viewNode.nodeUri):o,n))}),Promise.resolve(t))):t})}([],[],this);this.children=void 0,yield function i(o,n){return e(this,void 0,void 0,function*(){if(0!=n.length){const e=yield o.getChildren(),d=t.groupBy(n.filter(e=>0!=e.length),e=>e[0]);1===e.length&&o.autoExpand&&0===d.size&&e[0].expandable()&&e[0].viewNode.nodeUri&&d.set(e[0].viewNode.nodeUri,[[""]]),yield Promise.all(e.map(e=>{const t=e.viewNode.nodeUri?d.get(e.viewNode.nodeUri):void 0;return void 0===t?Promise.resolve():(e.expanded=!0,i(e,t.map(e=>e.slice(1))))}))}})}(this,d),void 0!==i&&(this.viewNode=i);const r=yield this.collectVisibleNodes(),s=function(e){let i=0;for(;i<e.oldNodes.length&&i<e.newNodes.length&&o(e.oldNodes[i],e.newNodes[i]);)i++;let t=0;for(;i+t<e.oldNodes.length&&i+t<e.newNodes.length&&o(e.oldNodes[e.oldNodes.length-t-1],e.newNodes[e.newNodes.length-t-1]);)t++;const n=0!==t?e.oldNodes.slice(i,-t):e.oldNodes.slice(i),d=0!==t?e.newNodes.slice(i,-t):e.newNodes.slice(i);return 0===n.length&&0===d.length?void 0:d.length>0?{root:d[0],oldNodes:n,newNodes:d,focusEvent:!1}:e}({root:this.makeView(),oldNodes:n,newNodes:r,focusEvent:!1});void 0!==s&&this.emitter.fire(s)})}getChildren(){if(void 0===this.children){const e=this.level,i=Promise.resolve(this.provider.loadNodeChildren(this.viewNode.nodeUri)).then(i=>i.map(i=>new o(i,e+1,this.provider,this.emitter,this.autoExpand)));return this.children=i}return this.children}height(){return e(this,void 0,void 0,function*(){if(this.isExpanded()){const e=yield this.getChildren();return(yield Promise.all(e.map(e=>e.height()))).reduce((e,i)=>e+i,1)}return 1})}collectVisibleNodes(){return e(this,void 0,void 0,function*(){return function i(t,o){return e(this,void 0,void 0,function*(){const e=t.concat(o.makeView());return o.isExpanded()?(yield o.getChildren()).reduce((e,t)=>e.then(e=>i(e,t)),Promise.resolve(e)):e})}([],this)})}touch(){return e(this,void 0,void 0,function*(){const e=this.lastTouch=Date.now();if(this.isExpanded()){const i=yield this.getChildren();return Promise.all(i.map(e=>e.touch())).then(i=>e)}return e})}markAsDefunct(){return e(this,void 0,void 0,function*(){if(this.defunct=!0,this.isExpanded()){const e=yield this.getChildren();yield Promise.all(e.map(e=>e.markAsDefunct()))}})}makeView(){return{underlying:this.viewNode,level:this.level,expandable:this.expandable(),expanded:this.isExpanded()}}}exports.Node=o;class n{constructor(e,t){this.provider=e,this.autoExpand=t,this.emitter=new i.Emitter,this.updateEvents=this.emitter.event,this.visible=!1;const n=e.viewId,d={viewId:n,label:n};this.rootNode=new o(d,0,e,this.emitter,this.autoExpand),e.updatedNodes(e=>{void 0!==e.nodeUri?this.findNodeByUri(e.nodeUri).then(i=>{if(void 0!==i)return i.refreshSubtree(e)}):this.rootNode.refreshSubtree(void 0)})}get viewId(){return this.provider.viewId}show(){if(!this.visible)return this.visible=!0,this.provider.sendTreeViewVisibilityNotification(!0)}hide(){if(this.visible)return this.visible=!1,this.provider.sendTreeViewVisibilityNotification(!1)}findNodeWithOffsetInternal(i,t){return e(this,void 0,void 0,function*(){if(0==t)return i;return(yield i.getChildren()).reduce((i,o)=>e(this,void 0,void 0,function*(){const e=yield i;return e.result?e:o.height().then(i=>e.height+i<=t?{height:e.height+i,result:void 0}:this.findNodeWithOffsetInternal(o,t-e.height).then(e=>({height:0,result:e})))}),Promise.resolve({height:1})).then(e=>e.result)})}findNodeWithOffset(i){return e(this,void 0,void 0,function*(){return this.findNodeWithOffsetInternal(this.rootNode,i)})}findNodeOffset(i){return e(this,void 0,void 0,function*(){return function t(o,n){return e(this,void 0,void 0,function*(){if(n.viewNode.nodeUri===i.underlying.nodeUri||o[1])return[o[0],!0];if(n.isExpanded()){const i=yield n.getChildren(),d=[o[0]+1,o[1]];return i.reduce((i,o)=>e(this,void 0,void 0,function*(){return i.then(e=>t(e,o))}),Promise.resolve(d))}return[o[0]+1,o[1]]})}([0,!1],this.rootNode).then(([e,i])=>i?e:void 0)})}findParentNode(i){return e(this,void 0,void 0,function*(){return function t(o,n){return e(this,void 0,void 0,function*(){return void 0!==o?o:n.isExpanded()?(yield n.getChildren()).reduce((o,d)=>e(this,void 0,void 0,function*(){const e=yield o;return void 0!==e?e:d.viewNode.nodeUri===i.viewNode.nodeUri?n:t(void 0,d)}),Promise.resolve(void 0)):void 0})}(void 0,this.rootNode)})}revealDocument(i,t){return e(this,void 0,void 0,function*(){const e=(yield Promise.resolve(this.provider.loadParentInfo(i,t))).uriChain.reverse(),o=yield this.revealDocumentInternal(e,this.rootNode);return void 0!==o&&this.emitter.fire({root:o.makeView(),oldNodes:[],newNodes:[],focusEvent:!0}),o})}revealByParents(i){return e(this,void 0,void 0,function*(){return this.revealDocumentInternal(i,this.rootNode)})}revealDocumentInternal(i,t){return e(this,void 0,void 0,function*(){if(0==i.length)return t;{const e=i[0];if(!!t.isExpanded()||(yield t.expand())){const o=(yield t.getChildren()).find(i=>i.viewNode.nodeUri===e);return o?this.revealDocumentInternal(i.slice(1),o):void 0}}})}findNodeByUri(i){return e(this,void 0,void 0,function*(){return function t(o,n){return e(this,void 0,void 0,function*(){return void 0!==o?o:n.viewNode.nodeUri===i?n:n.isExpanded()?(yield n.getChildren()).reduce((i,o)=>e(this,void 0,void 0,function*(){return i.then(e=>t(e,o))}),Promise.resolve(void 0)):void 0})}(void 0,this.rootNode)})}dispose(){this.emitter.dispose()}}exports.TreeModel=n;
},{"./utils":"Iw8s"}],"dDyQ":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,i,n,t){return new(n||(n=Promise))(function(o,d){function s(e){try{l(t.next(e))}catch(i){d(i)}}function r(e){try{l(t.throw(e))}catch(i){d(i)}}function l(e){var i;e.done?o(e.value):(i=e.value,i instanceof n?i:new n(function(e){e(i)})).then(s,r)}l((t=t.apply(e,i||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TreeView=void 0;const i=require("coc.nvim"),n=require("./utils"),t=require("../commands");class o{constructor(e,i,n,t,o){this.nvim=e,this.config=i,this.buffer=n,this.model=t,this.logger=o,this.firstUpdate=!0,this.closed="▸",this.open="▾",this.eventQueue=Promise.resolve(1),this.highlightPlaceId=0}init(){return e(this,void 0,void 0,function*(){yield this.nvim.command(`silent file ${this.model.viewId}`);const e="nnoremap <buffer> <silent>";function i(e){return`:<C-u>CocCommand metals.tvp.view ${e} <CR>`}yield this.nvim.command(`${e} ${this.config.get("toggleNode")} ${i("ToggleNode")}`),yield this.nvim.command(`${e} ${this.config.get("forceChildrenReload")} ${i("ForceChildrenReload")}`),yield this.nvim.command(`${e} ${this.config.get("gotoParentNode")} ${i("ParentNode")}`),yield this.nvim.command(`${e} ${this.config.get("gotoFirstChild")} ${i("FirstSibling")}`),yield this.nvim.command(`${e} ${this.config.get("gotoLastChild")} ${i("LastSibling")}`),yield this.nvim.command(`${e} ${this.config.get("gotoPrevSibling")} ${i("PrevSibling")}`),yield this.nvim.command(`${e} ${this.config.get("gotoLastSibling")} ${i("NextSibling")}`),yield this.nvim.command(`${e} ${this.config.get("executeCommand")} ${i("ExecuteCommand")}`),yield this.nvim.command(`${e} ${this.config.get("executeCommandAndOpenSplit")} ${i("ExecuteCommandAndOpenSplit")}`),yield this.nvim.command(`${e} ${this.config.get("executeCommandAndOpenVSplit")} ${i("ExecuteCommandAndOpenVSplit")}`),yield this.nvim.command(`${e} ${this.config.get("executeCommandAndOpenTab")} ${i("ExecuteCommandAndOpenTab")}`),yield this.nvim.command(`au BufWinLeave <buffer> CocCommand metals.tvp.view Hidden ${this.model.viewId}`),yield this.nvim.command("setlocal nonumber norelativenumber nobuflisted nowrap noswapfile winfixwidth winfixheight"),yield this.nvim.command("setlocal statusline=%f buftype=nofile bufhidden=hide"),this.model.updateEvents(e=>this.handleModelUpdates(e));const n=this.config.get("initialViews");yield this.model.rootNode.expand();const o=null==n?void 0:n.find(e=>e.name===this.model.viewId);void 0!==o&&(yield Promise.all(o.expanded.map(e=>this.model.revealByParents(e.concat("")))),yield this.nvim.call(t.Commands.MOVE_TO,[0,1]))})}get bufferId(){return this.buffer.id}restoreCursor(i,n,t){return e(this,void 0,void 0,function*(){yield i.setCursor([n,1]),yield i.setCursor([t,1])})}handleModelUpdates(t){let o;o=void 0===t.root.underlying.nodeUri?{root:t.newNodes[1],oldNodes:t.oldNodes.slice(1),newNodes:t.newNodes.slice(1),focusEvent:t.focusEvent}:t,this.eventQueue=this.eventQueue.then(t=>e(this,void 0,void 0,function*(){const t=void 0!==o.root?yield this.model.findNodeOffset(o.root):1;if(void 0===t)return;const d=t-1,s=yield this.nvim.tabpage,r=yield this.nvim.windows,l=yield s.windows,c=yield this.nvim.call("win_findbuf",this.bufferId),a=r.filter(e=>-1!=c.indexOf(e.id));if(o.focusEvent)void 0!==o.root&&this.logger.debug(`Focus event. Root: ${o.root.underlying.nodeUri}, offset: ${d}.`),yield n.sequence(a,i=>e(this,void 0,void 0,function*(){void 0!==l.find(e=>e.id===i.id)&&(yield this.nvim.call("win_gotoid",[i.id]),yield this.restoreCursor(i,1,d+1),yield this.nvim.command("redraw"))}));else{const t=o.newNodes.map(e=>e.underlying.nodeUri).join(",");void 0!==o.root&&this.logger.debug(`Update event. Root: ${o.root.underlying.nodeUri}, length: ${o.oldNodes.length}, payload: ${t}.`),yield this.modifyBuffer(()=>e(this,void 0,void 0,function*(){const t=yield n.sequence(a,n=>e(this,void 0,void 0,function*(){const e=yield n.cursor;if(i.workspace.isVim&&void 0!==l.find(e=>e.id===n.id)){const e=(yield this.nvim.call("win_execute",[n.id,'echo line(".").":".line("w0")'])).split(":").map(e=>parseInt(e,10));return{window:n,curLine:e[0],topLine:e[1]}}return{window:n,curLine:e[0],topLine:void 0}}));yield this.removeRows(d,o.oldNodes),yield this.insertRows(d,o.newNodes),yield n.sequence(t,({window:i,curLine:n,topLine:t})=>e(this,void 0,void 0,function*(){void 0!==t?(yield this.restoreCursor(i,t,n),yield this.nvim.call("win_execute",[i.id,"redraw"])):yield i.setCursor([n,1])})),this.firstUpdate&&(this.firstUpdate=!1,yield this.buffer.remove(o.newNodes.length,o.newNodes.length+1))}))}}))}removeRows(i,n){return e(this,void 0,void 0,function*(){yield this.buffer.remove(i,i+n.length)})}insertRows(i,n){return e(this,void 0,void 0,function*(){yield this.buffer.insert(this.makeRows(n),i),yield Promise.all(n.map((e,n)=>{let t;switch(e.underlying.icon){case"trait":t="TvpTrait";break;case"class":t="TvpClass";break;case"object":t="TvpObject";break;case"method":t="TvpMethod";break;case"val":t="TvpVal";break;case"command":case"sync":case"connect":case"cascade":case"cancel":case"clean":case"debug-stop":t="TvpCommand";break;default:t="TvpTopLevel"}const o=this.highlightPlaceId++,d=i+n;return this.logger.debug(`signplace id=${o} schema=${t} num=${d} uri=${e.underlying.nodeUri}`),this.buffer.addHighlight({hlGroup:t,line:d})}))})}toggleTreeViewNode(){return e(this,void 0,void 0,function*(){const e=yield this.nodeUnderCursor();void 0!==e&&e.expandable()&&(yield e.isExpanded()?e.collapse():e.expand())})}forceChildrenReload(){return e(this,void 0,void 0,function*(){const e=yield this.nodeUnderCursor();void 0!==e&&e.expandable()&&(e.isExpanded()||(yield e.expand()),e.refreshSubtree(void 0))})}gotoParentNode(){return e(this,void 0,void 0,function*(){const e=yield this.nodeUnderCursor();if(void 0===e)return;const i=yield this.model.findParentNode(e);if(void 0===i)return;const n=yield this.model.findNodeOffset(i.makeView());void 0!==n&&(yield this.nvim.call(t.Commands.MOVE_TO,[n-1,1]))})}gotoEdgeNode(i){return e(this,void 0,void 0,function*(){const e=yield this.nodeUnderCursor();if(void 0===e)return;const n=yield this.model.findParentNode(e);if(void 0===n)return;const o=yield n.getChildren();if(o.length>0){const e=i?o[0]:o[o.length-1],n=yield this.model.findNodeOffset(e.makeView());if(void 0===n)return;yield this.nvim.call(t.Commands.MOVE_TO,[n-1,1])}})}gotoNeighboringSibling(i){return e(this,void 0,void 0,function*(){const e=yield this.nodeUnderCursor();if(void 0===e)return;const n=yield this.model.findParentNode(e);if(void 0===n)return;const o=yield n.getChildren(),d=o.findIndex(i=>i.viewNode.nodeUri===e.viewNode.nodeUri);let s;if(void 0===(s=i&&d>0?o[d-1]:!i&&d+1<o.length?o[d+1]:void 0))return;const r=yield this.model.findNodeOffset(s.makeView());void 0!==r&&(yield this.nvim.call(t.Commands.MOVE_TO,[r-1,1]))})}executeCommand(){return e(this,void 0,void 0,function*(){const e=yield this.nodeUnderCursor();if(void 0===e)return;const n=e.viewNode.command;return void 0!==n?void 0!==n.arguments?i.commands.executeCommand(n.command,...n.arguments):i.commands.executeCommand(n.command):void 0})}revealDocInTreeView(i,n){return e(this,void 0,void 0,function*(){return this.model.revealDocument(i,n)})}makeRows(e){return e.map(e=>{let i;return i=e.expandable?(e.expanded?this.open:this.closed)+" ":"  ","  ".repeat(e.level-1)+i+e.underlying.label})}nodeUnderCursor(){return e(this,void 0,void 0,function*(){const e=(yield this.nvim.eval("coc#util#cursor()"))[0];return this.model.findNodeWithOffset(e+1)})}modifyBuffer(i){return e(this,void 0,void 0,function*(){try{return yield this.buffer.setOption("readonly",!1),yield this.buffer.setOption("modifiable",!0),yield i()}finally{yield this.buffer.setOption("modifiable",!1),yield this.buffer.setOption("readonly",!0)}})}dispose(){this.nvim.command(`bd ${this.bufferId}`,!0)}}exports.TreeView=o;
},{"./utils":"Iw8s","../commands":"eojW"}],"GgEX":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,i,t,n){return new(t||(t=Promise))(function(o,r){function s(e){try{l(n.next(e))}catch(i){r(i)}}function d(e){try{l(n.throw(e))}catch(i){r(i)}}function l(e){var i;e.done?o(e.value):(i=e.value,i instanceof t?i:new t(function(e){e(i)})).then(s,d)}l((n=n.apply(e,i||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TreeViewsManager=exports.WindowProp=void 0;const i=require("coc.nvim"),t=require("./treeview"),n=require("./utils"),o=require("../commands");var r;!function(e){e[e.Default=0]="Default",e[e.HSplit=1]="HSplit",e[e.VSplit=2]="VSplit",e[e.Tab=3]="Tab"}(r=exports.WindowProp||(exports.WindowProp={}));class s{constructor(e,t){this.nvim=e,this.logger=t,this.view2treemodel=new Map,this.view2treeview=new Map,this.lastWindowProp=[r.Default,0],this.config=i.workspace.configurations.getConfiguration("metals.treeviews"),this.nvim.command("highlight default link TvpClass Constant",!0),this.nvim.command("highlight default link TvpObject PreProc",!0),this.nvim.command("highlight default link TvpTrait Statement",!0),this.nvim.command("highlight default link TvpMethod Identifier",!0),this.nvim.command("highlight default link TvpVal Type",!0),this.nvim.command("highlight default link TvpTopLevel MsgArea",!0),this.nvim.command("highlight default link TvpCommand Directory",!0),this.nvim.command("sign define TvpClass linehl=TvpClass",!0),this.nvim.command("sign define TvpObject linehl=TvpObject",!0),this.nvim.command("sign define TvpTrait linehl=TvpTrait",!0),this.nvim.command("sign define TvpMethod linehl=TvpMethod",!0),this.nvim.command("sign define TvpVal linehl=TvpVal",!0),this.nvim.command("sign define TvpVal linehl=TvpTopLevel",!0),this.nvim.command("sign define TvpVal linehl=TvpCommand",!0)}addTreeModel(e){this.view2treemodel.set(e.viewId,e)}disposeTreeModel(e){this.view2treemodel.delete(e)}allTreeViews(){return[...this.view2treemodel.keys()]}toggleAllTrees(){var i;return e(this,void 0,void 0,function*(){const t=this.allTreeViews();if(!this.checkTreeViewAvailability(t))return;const[o,r]=yield this.getOpenWindows(t);if(r.length>0)yield Promise.all(r.map(({window:e})=>e.close(!0))),t.forEach(e=>o.setVar(e,0,!1));else{const r=null!==(i=this.config.get("initialViews"))&&void 0!==i?i:[],s=yield n.sequence(t.filter(e=>void 0!==r.find(i=>i.name===e)).sort(this.viewsComparator(r)),(i,t)=>e(this,void 0,void 0,function*(){0==t?yield this.makeTreeViewPanel(i):yield this.nvim.command(`new ${i}`);const e=yield this.assignOrCreateTreeView(o,i);return{name:i,window:e}}));yield this.alignWindows(s,r)}})}toggleTreeView(i){var t;return e(this,void 0,void 0,function*(){const e=this.allTreeViews();if(!this.checkTreeViewAvailability(e))return;if(!this.checkTreeViewExistence(e,i))return;const[n,o]=yield this.toggleTreeViewInternal(e,i,!1),r=null!==(t=this.config.get("initialViews"))&&void 0!==t?t:[];return n?this.alignWindows(o,r):void 0})}toggleTreeViewInternal(i,t,n){return e(this,void 0,void 0,function*(){const[e,o]=yield this.getOpenWindows(i),r=o.find(({name:e})=>e==t);if(void 0!==r)return n||(yield r.window.close(!0),yield e.setVar(t,0,!1)),[!1,[]];if(0!=o.length){const i=o[0].window;yield this.nvim.call("win_gotoid",i.id),yield this.nvim.command(`new ${t}`);const n=yield this.assignOrCreateTreeView(e,t);return[!0,o.concat({name:t,window:n})]}{yield this.makeTreeViewPanel(t);const i=yield this.assignOrCreateTreeView(e,t);return[!0,o.concat({name:t,window:i})]}})}revealDocInTreeView(i,t,n){var o;return e(this,void 0,void 0,function*(){const e=this.allTreeViews();if(!this.checkTreeViewAvailability(e))return;if(!this.checkTreeViewExistence(e,i))return;const[r,s]=yield this.toggleTreeViewInternal(e,i,!0),d=null!==(o=this.config.get("initialViews"))&&void 0!==o?o:[];r&&(yield this.alignWindows(s,d));const l=this.view2treeview.get(i);return null==l?void 0:l.revealDocInTreeView(t,n).then(()=>void 0)})}makeTreeViewPanel(e){const i=this.config.get("initialWidth"),t="right"==this.config.get("alignment")?"botright":"topleft";return this.nvim.command(`silent ${t} vertical ${i} new ${e}`)}getOpenWindows(i){return e(this,void 0,void 0,function*(){const t=yield this.nvim.tabpage,n=yield this.nvim.windows,o=yield Promise.all(i.map(i=>e(this,void 0,void 0,function*(){const e=yield t.getVar(i);return{name:i,window:n.find(i=>i.id==e)}}))).then(e=>e.filter(e=>void 0!==e.window));return[t,o]})}assignOrCreateTreeView(i,n){return e(this,void 0,void 0,function*(){const e=this.view2treeview.get(n),r=this.view2treemodel.get(n);if(null==r||r.show(),void 0!==e)yield this.nvim.call(o.Commands.MOVE_TO,[0,1]);else if(void 0!==r){const e=yield this.nvim.buffer,i=new t.TreeView(this.nvim,this.config,e,r,this.logger);yield i.init(),this.view2treeview.set(n,i)}const s=yield this.nvim.window;yield i.setVar(n,s.id,!1);const d=yield i.getVar("alltreeviews");return null===d?yield i.setVar("alltreeviews",n,!1):-1==d.indexOf(n)&&(yield i.setVar("alltreeviews",`${d},${n}`,!1)),s})}checkTreeViewAvailability(e){return void 0!==e&&0!=e.length||(i.workspace.showMessage("Information about Tree Views is not yet loaded. Please try a bit later.","warning"),!1)}checkTreeViewExistence(e,t){return-1!=e.indexOf(t)||(i.workspace.showMessage(`Unknown view name ${t}. Available values: ${e.join(", ")}`,"error"),!1)}alignWindows(i,t){return e(this,void 0,void 0,function*(){const e=(yield Promise.all(i.map(({window:e})=>e.height))).reduce((e,i)=>e+i,0),n=i.map(({name:e,window:i})=>{const n=t.find(i=>i.name===e);let o;return[i,o=void 0===n?0!=t.length?t.reduce((e,i)=>Math.min(e,i.size),Number.MAX_VALUE):10:n.size]}),o=n.map(([e,i])=>i).reduce((e,i)=>e+i);yield Promise.all(n.map(([i,t])=>i.setHeight(Math.floor(t*e/o))))})}toggleTreeViewNode(){return e(this,void 0,void 0,function*(){return this.doOnActiveTree(e=>e.toggleTreeViewNode())})}forceChildrenReload(){return e(this,void 0,void 0,function*(){return this.doOnActiveTree(e=>e.forceChildrenReload())})}gotoParentNode(){return e(this,void 0,void 0,function*(){return this.doOnActiveTree(e=>e.gotoParentNode())})}gotoFirstNode(){return e(this,void 0,void 0,function*(){return this.doOnActiveTree(e=>e.gotoEdgeNode(!0))})}gotoLastNode(){return e(this,void 0,void 0,function*(){return this.doOnActiveTree(e=>e.gotoEdgeNode(!1))})}gotoPrevSibling(){return e(this,void 0,void 0,function*(){return this.doOnActiveTree(e=>e.gotoNeighboringSibling(!0))})}gotoNextSibling(){return e(this,void 0,void 0,function*(){return this.doOnActiveTree(e=>e.gotoNeighboringSibling(!1))})}executeCommand(i){return e(this,void 0,void 0,function*(){return this.doOnActiveTree(t=>e(this,void 0,void 0,function*(){this.lastWindowProp=[i,Date.now()],yield t.executeCommand()}))})}doOnActiveTree(i){return e(this,void 0,void 0,function*(){const e=yield this.nvim.eval('bufnr("%")'),t=[...this.view2treeview.values()].find(i=>i.bufferId==e);return void 0===t?this.nvim.command("echo 'no active tree view'"):i(t)})}viewsComparator(e){return(i,t)=>{const n=e.findIndex(e=>e.name===i),o=e.findIndex(e=>e.name===t);return-1==n&&-1==o?0:-1==n?1:-1==o?-1:o-n}}prepareWindowForGoto(){return e(this,void 0,void 0,function*(){const e=Date.now()-this.lastWindowProp[1]<1e3?this.lastWindowProp[0]:r.Default;if(e===r.Tab)yield this.nvim.command("tabnew");else{const i=yield this.nvim.tabpage,t=(yield i.getVar("alltreeviews"))||"",n=yield Promise.all(t.split(",").map(e=>i.getVar(e))),o=yield i.windows,s=o.map(e=>e.id).sort().find(e=>void 0===n.find(i=>e===i));if(void 0===s){const e=this.config.get("initialWidth"),i="right"==this.config.get("alignment")?"topleft":"botright";if(o.length>0){const t=yield o[0].width;yield this.nvim.command(`silent ${i} vertical new`),yield this.nvim.command(`silent vertical resize ${t-e}`)}else yield this.nvim.command(`silent ${i} vertical new`)}else yield this.nvim.call("win_gotoid",s),e===r.HSplit?yield this.nvim.command("split"):e===r.VSplit&&(yield this.nvim.command("vsplit"))}})}viewHidden(e){const i=this.view2treemodel.get(e);void 0!==i&&i.hide()}dispose(){this.view2treeview.forEach(e=>e.dispose())}}exports.TreeViewsManager=s;
},{"./treeview":"dDyQ","./utils":"Iw8s","../commands":"eojW"}],"bAI2":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function s(e){try{d(o.next(e))}catch(t){r(t)}}function a(e){try{d(o.throw(e))}catch(t){r(t)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}d((o=o.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TreeViewController=void 0;const t=require("coc.nvim"),n=require("./model"),o=require("./treeviews"),i=[{title:"Expand/Collapse tree node",action:"ToggleNode"},{title:"Force the reloading of the children of this node.",action:"ForceChildrenReload"},{title:"Go to parent node",action:"ParentNode"},{title:"Go to first child",action:"FirstSibling"},{title:"Go to last child",action:"LastSibling"},{title:"Go to prev sibling",action:"PrevSibling"},{title:"Go to next sibling",action:"NextSibling"},{title:"Execute command for node",action:"ExecuteCommand"},{title:"Execute command and open node under cursor in horizontal split",action:"ExecuteCommandAndOpenSplit"},{title:"Execute command and open node under cursor in vertical split",action:"ExecuteCommandAndOpenVSplit"},{title:"Execute command and open node under cursor in tab",action:"ExecuteCommandAndOpenTab"}];class r{constructor(r,s){this.treeViewsManager=s,this.treeModels=new Map,this.listeners=[],this.listeners.push(r.providerEvents()(e=>{const t=new n.TreeModel(e,!0);this.treeModels.set(e.viewId,t),s.addTreeModel(t)})),this.listeners.push(t.commands.registerCommand("metals.tvp",e=>{void 0===e?s.toggleAllTrees():s.toggleTreeView(e)}));const a=(e,n)=>{switch(e){case"ToggleNode":return s.toggleTreeViewNode();case"ForceChildrenReload":return s.forceChildrenReload();case"ParentNode":return s.gotoParentNode();case"FirstSibling":return s.gotoFirstNode();case"LastSibling":return s.gotoLastNode();case"PrevSibling":return s.gotoPrevSibling();case"NextSibling":return s.gotoNextSibling();case"ExecuteCommand":return s.executeCommand(o.WindowProp.Default);case"ExecuteCommandAndOpenSplit":return s.executeCommand(o.WindowProp.HSplit);case"ExecuteCommandAndOpenVSplit":return s.executeCommand(o.WindowProp.VSplit);case"ExecuteCommandAndOpenTab":return s.executeCommand(o.WindowProp.Tab);case"Hidden":return n&&s.viewHidden(n);default:t.workspace.showQuickpick(i.map(e=>e.title)).then(e=>{-1!==e&&a(i[e].action,void 0)})}};this.listeners.push(t.commands.registerCommand("metals.tvp.view",a)),this.listeners.push(t.commands.registerCommand("metals.revealInTreeView",n=>e(this,void 0,void 0,function*(){const{document:e,position:o}=yield t.workspace.getCurrentState();return this.treeViewsManager.revealDocInTreeView(n,e,o)})))}dispose(){this.treeModels.forEach(e=>e.dispose()),this.treeModels.clear(),this.listeners.forEach(e=>e.dispose())}}exports.TreeViewController=r;
},{"./model":"Vq4m","./treeviews":"GgEX"}],"Y104":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(o,r){function n(e){try{d(s.next(e))}catch(t){r(t)}}function a(e){try{d(s.throw(e))}catch(t){r(t)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,a)}d((s=s.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.TreeViewFeature=void 0;const t=require("coc.nvim"),i=require("metals-languageclient"),s=require("vscode-languageserver-protocol");class o{constructor(e){this._client=e,this.requestType=new s.RequestType("metals/treeView"),this.providerEmitter=new s.Emitter,this.viewUpdaters=new Map,this.mbGotoCommandDisposable=void 0}get messages(){return this.requestType}fillClientCapabilities(){}initialize(){const o=this._client;o.onNotification(i.MetalsTreeViewDidChange.type,e=>{e.nodes.forEach(e=>{const t=e.viewId,r=this.viewUpdaters.get(t);if(void 0===r){const e=new s.Emitter,r={viewId:t,updatedNodes:e.event,loadNodeChildren:e=>{const s=o.sendRequest(i.MetalsTreeViewChildren.type,{viewId:t,nodeUri:e}).then(e=>e.nodes);return Promise.resolve(s)},loadParentInfo:(e,t)=>{const s={line:t.line+1,character:t.character},r={textDocument:{uri:e.uri},position:s};return Promise.resolve(o.sendRequest(i.MetalsTreeViewReveal.type,r))},sendTreeViewVisibilityNotification:e=>{o.sendNotification(i.MetalsTreeViewVisibilityDidChange.type,{viewId:t,visible:e})},sendTreeNodeVisibilityNotification:(e,s)=>{o.sendNotification(i.MetalsTreeViewNodeCollapseDidChange.type,{viewId:t,nodeUri:e,collapsed:s})}};this.providerEmitter.fire(r),this.viewUpdaters.set(t,e)}else r.fire(e)})}),this.mbGotoCommandDisposable=t.commands.registerCommand(`metals.${i.ServerCommands.Goto}`,(...t)=>e(this,void 0,void 0,function*(){let e={command:i.ServerCommands.Goto,arguments:t};return o.sendRequest(s.ExecuteCommandRequest.type,e).then(void 0,e=>{o.logFailedRequest(s.ExecuteCommandRequest.type,e)})}),null,!0)}providerEvents(){return this.providerEmitter.event}register(e,t){}unregister(e){}dispose(){this.providerEmitter.dispose(),this.viewUpdaters.forEach(e=>e.dispose()),void 0!==this.mbGotoCommandDisposable&&this.mbGotoCommandDisposable.dispose()}}exports.TreeViewFeature=o;
},{}],"UnXq":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,o,t,n){void 0===n&&(n=t),Object.defineProperty(e,n,{enumerable:!0,get:function(){return o[t]}})}:function(e,o,t,n){void 0===n&&(n=t),e[n]=o[t]}),o=this&&this.__setModuleDefault||(Object.create?function(e,o){Object.defineProperty(e,"default",{enumerable:!0,value:o})}:function(e,o){e.default=o}),t=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var n={};if(null!=t)for(var r in t)"default"!==r&&Object.prototype.hasOwnProperty.call(t,r)&&e(n,t,r);return o(n,t),n};Object.defineProperty(exports,"__esModule",{value:!0}),exports.detectLaunchConfigurationChanges=exports.wait=exports.toggleLogs=exports.checkServerVersion=exports.trackDownloadProgress=void 0;const n=require("coc.nvim"),r=t(require("metals-languageclient")),s=require("metals-languageclient"),i=require("./commands");function a(e,o,t){return s.downloadProgress({download:o,onProgress:o=>{t.text=e,t.show()},onError:t.dispose,onComplete:t.dispose})}function c(e){r.checkServerVersion({config:e,updateConfig:({configSection:o,latestServerVersion:t})=>{e.update(o,t,!0)},onOutdated:({message:e,upgradeChoice:o,openSettingsChoice:t,dismissChoice:r,upgrade:s})=>{n.workspace.showQuickpick([o,t,r],e).then(e=>{0===e?s():1===e&&n.workspace.nvim.command(i.Commands.OPEN_COC_CONFIG,!0)})}})}function u(){const e=n.workspace.documents.find(e=>"output:/metals"==e.uri);e?n.workspace.nvim.command(`bd ${e.bufnr}`):n.workspace.nvim.command(i.Commands.OPEN_LOGS)}function d(e){return new Promise(o=>{setTimeout(o,e)})}function p(){r.detectLaunchConfigurationChanges(n.workspace,({message:e,reloadWindowChoice:o,dismissChoice:t})=>n.workspace.showQuickpick([o,t],e).then(e=>{0===e&&n.workspace.nvim.command(i.Commands.RESTART_COC,!0)}),["statusBarEnabled","bloopVersion","enable"])}exports.trackDownloadProgress=a,exports.checkServerVersion=c,exports.toggleLogs=u,exports.wait=d,exports.detectLaunchConfigurationChanges=p;
},{"./commands":"eojW"}],"OSfr":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(s,o){function r(e){try{u(i.next(e))}catch(t){o(t)}}function a(e){try{u(i.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,a)}u((i=i.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DebuggingFeature=void 0;const t=require("vscode-languageserver-protocol"),n=require("coc.nvim"),i=require("metals-languageclient");class s{constructor(e,t){this._nvim=e,this._client=t}fillInitializeParams(){}fillClientCapabilities(){}initialize(){const s=(n,...s)=>e(this,void 0,void 0,function*(){let n={command:i.ServerCommands.DebugAdapterStart,arguments:s};return this._client.sendRequest(t.ExecuteCommandRequest.type,n).then(t=>e(this,void 0,void 0,function*(){const e=t.uri.lastIndexOf(":");if(-1!==e){const n=parseInt(t.uri.substr(e+1));yield this._nvim.call("vimspector#LaunchWithSettings",[{configuration:"coc-metals",port:n}])}}),e=>{this._client.logFailedRequest(t.ExecuteCommandRequest.type,e)})});n.commands.registerCommand(i.ClientCommands.StartRunSession,s.bind(this,!1),null,!0),n.commands.registerCommand(i.ClientCommands.StartDebugSession,s.bind(this,!0),null,!0)}}exports.DebuggingFeature=s;
},{}],"n7Rg":[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,s,e,i){return new(e||(e=Promise))(function(r,h){function o(t){try{c(i.next(t))}catch(s){h(s)}}function n(t){try{c(i.throw(t))}catch(s){h(s)}}function c(t){var s;t.done?r(t.value):(s=t.value,s instanceof e?s:new e(function(t){t(s)})).then(o,n)}c((i=i.apply(t,s||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const s=require("coc.nvim");class e{constructor(t,s,e){this.frames=["⠋","⠙","⠹","⠸","⠼","⠴","⠦","⠧","⠇","⠏"],this.counter=0,this.isProgress=!1,this.text="",this.priority=0,this.hide=(()=>this.dispose()),this.show=(()=>this.showText()),this.dispose=(()=>clearInterval(this.interval)),this.update=(t=>this.text=t),this.priority=t,this.isProgress=s,this.text=e,this.interval=setInterval(()=>{this.showText()},1e3)}getText(){let t;return void 0===this.frames[this.counter]&&(this.counter=0),this.isProgress&&""!==this.text.trim()?(t=this.text+this.frames[this.counter],this.counter++):t=this.text,t}showText(){return t(this,void 0,void 0,function*(){s.workspace.showMessage(this.getText())})}}exports.default=e;
},{}],"QCba":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),t=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(o){if(o&&o.__esModule)return o;var r={};if(null!=o)for(var n in o)"default"!==n&&Object.prototype.hasOwnProperty.call(o,n)&&e(r,o,n);return t(r,o),r},r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))(function(n,a){function s(e){try{c(r.next(e))}catch(t){a(t)}}function i(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(s,i)}c((r=r.apply(e,t||[])).next())})},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.activate=void 0;const a=require("coc.nvim"),s=require("metals-languageclient"),i=o(require("path")),c=require("vscode-languageserver-protocol"),m=require("./commands"),u=n(require("./decoration")),d=require("./embeddedDoctor"),l=require("./metalsProtocol"),p=require("./tvp/controller"),v=require("./tvp/feature"),g=require("./tvp/treeviews"),h=require("./utils"),w=require("./DebuggingFeature"),C=n(require("./WannaBeStatusBarItem"));function f(e){return r(this,void 0,void 0,function*(){const t=a.workspace.getConfiguration("metals");t.get("enable")&&(h.detectLaunchConfigurationChanges(),h.checkServerVersion(t),s.getJavaHome(t.get("javaHome")).then(o=>k(t,e,o),()=>{a.workspace.showQuickpick(["Open Settings","Ignore for now"],"Unable to find a Java 8 or Java 11 installation on this computer. To fix this problem, update the 'metals.javaHome' setting to point to a Java 8 or Java 11 home directory").then(e=>{0===e&&a.workspace.nvim.command(m.Commands.OPEN_COC_CONFIG,!0)})}))})}function k(e,t,o){var r,n;const i=s.checkDottyIde(null===(r=a.workspace.workspaceFolder)||void 0===r?void 0:r.uri);if(i.enabled)return void a.workspace.showMessage("Metals will not start since Dotty is enabled for this workspace. "+`To enable Metals, remove the file ${i.path} and run ':CocCommand metals.restartServer'`,"warning");const c=e.get("serverVersion"),u=e.inspect("serverVersion").defaultValue,d=c||u,l=e.get("serverProperties"),p=e.get("customRepositories"),v=s.getJavaConfig({workspaceRoot:null===(n=a.workspace.workspaceFolder)||void 0===n?void 0:n.uri,javaHome:o,customRepositories:p,extensionPath:t.extensionPath}),g=s.fetchMetals({serverVersion:d,serverProperties:l,javaConfig:v}),w=e.get("statusBarEnabled"),f=w?a.workspace.createStatusBarItem(0,{progress:!0}):new C.default(0,!0,"Preparing Metals"),k=`Downloading Metals v${d}`;h.trackDownloadProgress(k,g,f).then(e=>{y(t,e,l,v,f,w)},()=>{const e=(()=>{const e="See https://scalameta.org/metals/docs/build-tools/proxy.html for instructions if you are using an HTTP proxy.";return d===u?"Failed to download Metals, make sure you have an internet connection and "+`the Java Home '${o}' is valid. You can configure the Java Home in the settings.`+e:"Failed to download Metals, make sure you have an internet connection, "+`the Metals version '${d}' is correct and the Java Home '${o}' is valid. `+"You can configure the Metals version and Java Home in the settings."+e})();a.workspace.showPrompt(`${e}\n Open Settings?`).then(e=>{e&&a.workspace.nvim.command(m.Commands.OPEN_COC_CONFIG,!0)})})}function y(e,t,o,n,C,f){return r(this,void 0,void 0,function*(){const k=s.getServerOptions({metalsClasspath:t,serverProperties:o,javaConfig:n}),y={compilerOptions:{completionCommand:"editor.action.triggerSuggest",overrideDefFormat:"unicode",parameterHintsCommand:"editor.action.triggerParameterHints"},debuggingProvider:a.workspace.isNvim&&1===(yield a.workspace.nvim.getVar("loaded_vimpector")),decorationProvider:a.workspace.isNvim,didFocusProvider:!0,doctorProvider:"json",executeClientCommandProvider:!0,inputBoxProvider:!0,quickPickProvider:!0,slowTaskProvider:!0,statusBarProvider:f?"on":"show-message",treeViewProvider:!0},S={documentSelector:[{scheme:"file",language:"scala"}],synchronize:{configurationSection:"metals"},revealOutputChannelOn:a.RevealOutputChannelOn.Never,initializationOptions:y},P=new a.LanguageClient("metals","Metals",k,S),b=new v.TreeViewFeature(P);if(P.registerFeature(b),S.initializationOptions.debuggingProvider){const e=new w.DebuggingFeature(a.workspace.nvim,P);P.registerFeature(e)}const q=new a.FloatFactory(a.workspace.nvim,a.workspace.env,!1,100,100,!0),M=new u.default(q),R=new g.TreeViewsManager(a.workspace.nvim,e.logger),x=new p.TreeViewController(b,R);function O(t,o){e.subscriptions.push(a.commands.registerCommand(t,o))}e.subscriptions.push(b,R,x),O("metals.restartServer",s.restartServer(P,a.workspace)),e.subscriptions.push(P.start()),P.onReady().then(t=>{if(C.isProgress=!1,C.text="Metals is Ready!",C.show(),[s.ServerCommands.AmmoniteStart,s.ServerCommands.AmmoniteStop,s.ServerCommands.BspSwitch,s.ServerCommands.BuildConnect,s.ServerCommands.BuildDisconnect,s.ServerCommands.BuildImport,s.ServerCommands.BuildRestart,s.ServerCommands.CancelCompilation,s.ServerCommands.CascadeCompile,s.ServerCommands.CleanCompile,s.ServerCommands.DoctorRun,s.ServerCommands.GenerateBspConfig,s.ServerCommands.NewScalaProject,s.ServerCommands.ResetChoice,s.ServerCommands.SourcesScan].forEach(e=>{O("metals."+e,()=>r(this,void 0,void 0,function*(){P.sendRequest(c.ExecuteCommandRequest.type,{command:e})}))}),O(`metals.${s.ServerCommands.AnalyzeStacktrace}`,()=>r(this,void 0,void 0,function*(){if(a.workspace.isVim)a.workspace.showMessage("Analyze stacktrace functionality isn't support in Vim. Please use Nvim if you'd like to use this.","warning");else{const e=yield a.workspace.nvim.call("getreg","*");e.trim().length<1?a.workspace.showMessage("No text found in your register. Copy your stacktrace to your register and retry.","warning"):P.sendRequest(c.ExecuteCommandRequest.type,{command:s.ServerCommands.AnalyzeStacktrace,arguments:[e]})}})),O("metals.logs-toggle",()=>{h.toggleLogs()}),a.workspace.isNvim&&e.subscriptions.push(a.workspace.registerKeymap(["n"],"metals-expand-decoration",()=>{M.showHover()},{sync:!1})),O(`metals.${s.ServerCommands.NewScalaFile}`,()=>r(this,void 0,void 0,function*(){const e=(yield a.workspace.document).uri,t=i.dirname(e);P.sendRequest(c.ExecuteCommandRequest.type,{command:s.ServerCommands.NewScalaFile,arguments:[t]})})),O("metals.quick-worksheet",()=>r(this,void 0,void 0,function*(){const e=(yield a.workspace.document).uri,t=i.dirname(e),o=i.basename(t);P.sendRequest(c.ExecuteCommandRequest.type,{command:s.ServerCommands.NewScalaFile,arguments:[t,o,"worksheet"]})})),O(`metals.${s.ServerCommands.CopyWorksheetOutput}`,()=>r(this,void 0,void 0,function*(){const e=(yield a.workspace.document).uri,t=yield P.sendRequest(c.ExecuteCommandRequest.type,{command:s.ServerCommands.CopyWorksheetOutput,arguments:[e]});t.value&&(a.workspace.nvim.call("setreg",["+",t.value]),a.workspace.showMessage("Copied worksheet to to your +register"))})),O(`metals.${s.ServerCommands.GotoSuperMethod}`,()=>r(this,void 0,void 0,function*(){const e=yield a.workspace.document,t=yield a.workspace.getCursorPosition();P.sendRequest(c.ExecuteCommandRequest.type,{command:s.ServerCommands.GotoSuperMethod,arguments:[{document:e.uri,position:t}]})})),O(`metals.${s.ServerCommands.SuperMethodHierarchy}`,()=>r(this,void 0,void 0,function*(){const e=yield a.workspace.document,t=yield a.workspace.getCursorPosition();P.sendRequest(c.ExecuteCommandRequest.type,{command:s.ServerCommands.SuperMethodHierarchy,arguments:[{document:e.uri,position:t}]})})),P.onNotification(s.ExecuteClientCommand.type,e=>r(this,void 0,void 0,function*(){switch(e.command){case s.ClientCommands.GotoLocation:const t=e.arguments&&e.arguments[0];t&&(yield R.prepareWindowForGoto(),yield h.wait(10),yield a.workspace.jumpTo(t.uri,t.range.start));break;case s.ClientCommands.RunDoctor:const o=e.arguments&&e.arguments[0];d.makeVimDoctor(JSON.parse(o));break;case s.ClientCommands.ReloadDoctor:a.workspace.nvim.call(m.Commands.HAS_PREVIEW).then(t=>{if(t>0){const t=e.arguments&&e.arguments[0];d.makeVimDoctor(JSON.parse(t))}});break;case s.ClientCommands.FocusDiagnostics:a.workspace.nvim.command("CocList diagnostics");break;case s.ClientCommands.ToggleLogs:h.toggleLogs();break;case s.ClientCommands.RefreshModel:a.events.fire("BufEnter",[a.workspace.bufnr]);break;default:a.workspace.showMessage(`Recieved unknown command: ${e.command}`)}})),a.events.on("BufWinEnter",e=>{const t=a.workspace.documents.find(t=>t.bufnr===e);t&&"scala"===t.filetype&&P.sendNotification(s.MetalsDidFocus.type,t.uri)}),P.onRequest(s.MetalsInputBox.type,e=>a.workspace.callAsync("input",[`${e.prompt}: `,e.value?e.value:""]).then(s.MetalsInputBox.handleInput)),P.onRequest(s.MetalsQuickPick.type,(e,t)=>a.workspace.showQuickpick(e.items.map(e=>e.label),e.placeHolder).then(t=>-1===t?{cancelled:!0}:{itemId:e.items[t].id})),f){const e=a.workspace.createStatusBarItem(0);P.onNotification(s.MetalsStatus.type,t=>{t.show?e.text=t.text:t.hide&&(e.text="Metals"),e.show()})}a.workspace.isNvim&&(P.onNotification(l.DecorationsRangesDidChange.type,e=>{a.workspace.uri&&a.workspace.uri===e.uri&&M.setDecorations(e)}),a.events.on("BufWinLeave",e=>{const t=a.workspace.documents.find(t=>t.bufnr===e);t&&t.uri.endsWith(".worksheet.sc")&&M.clearDecorations(e)}))})})}exports.activate=f;
},{"./commands":"eojW","./decoration":"p29A","./embeddedDoctor":"BTOZ","./metalsProtocol":"z7J4","./tvp/controller":"bAI2","./tvp/feature":"Y104","./tvp/treeviews":"GgEX","./utils":"UnXq","./DebuggingFeature":"OSfr","./WannaBeStatusBarItem":"n7Rg"}]},{},["QCba"], null)